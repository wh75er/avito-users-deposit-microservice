# Тестовое задание на позицию стажера-бекендера

## Микросервис для работы с балансом пользователей

Здесь представлена реализация, документация, api микросервиса для работы с балансом пользователя

Оглавление:

- [Документация API](#документация-api)

## Документация API

Документация api изложена на английском и представлена в формате MD [здесь](docs/api.md).

## Таблицы БД

В качестве базы данных используется Postgresql

Здесь представлены таблицы БД, которые используются в проекте:


```sql
CREATE TABLE IF NOT EXISTS Deposits(
    Id serial PRIMARY KEY,
    UserUuid UUID NOT NULL UNIQUE,
    Deposit INT NOT NULL,
    CreationDate TIMESTAMP NOT NULL
);
```

```sql
CREATE TABLE IF NOT EXISTS Transactions(
    Id serial PRIMARY KEY,
    DepositId INT REFERENCES Deposits(Id),
    OwnerUuid UUID NOT NULL,
    Amount INT NOT NULL,
    Reason VARCHAR(250) NOT NULL,
    PartnerUuid UUID,
    TransactionDate TIMESTAMP NOT NULL
);
```

### Проблемы при проектировании api и других различных фич:

1. В тз нигде не указано как нужно проинициализировать пользователя. Можно сделать следующим образом:
    - Инициализировать пользователя при зачислении средств на баланс
      пользователя. Если его не существует, создавать юзера с депозитом в 0 и
      сразу начислять ему средства на баланс(Здесь решение не очевидное, так
      как хэндлер для зачисления средств начинает выполнять какую-то лишнюю и
      стороннюю работу).
    - Добавить отдельную ручку для добавления счета для пользователя в базу с
      нужным идентификатором(Допустим это UUID). Таким образом сервису
      пользователей при создании нового пользователя нужно будет отправить
      запрос на открытие счета для пользователя в данный микросервис(на мой
      взгляд более правильное решение)
2. Изменение баланса пользователя, которое тоже можно сделать разными методами:
    - PATCH запрос на изменение депозита для конкретного пользователя
    - Использование отдельных ручек в api для добавления средств и списания
      средств, например, deposit/{user-uuid}/raise и
      deposit/{user-uuid}/withdraw
    - Использование одной api ручки POST /deposit/{user-uuid}/change, где будет
      приходить int значение с - или + значением суммы(если <0, то списание,
      если >0, то зачисление)
    - В конце пришел к тому, что лучше сделать отдельную сущность для транзакций.
      Таким образом, при изменении счета следует просто добавлять новую запись
      в транзакции. Минусом такого подхода - толстый обработчик добавления транзакции
3. К чему должны быть привязаны транзакции в БД?
    - В идеале таблица транзакций должна ссылаться на какой-то счет(по идентификатору), но
      так как в данной архитектуре у пользователя может быть только один счет, можно сделать
      привязку к идентификатору юзера. Так как открытие нескольких счетов довольно специфическая
      фича, которая используется в основном только в банковских приложениях, я привяжу транзакцию
      к идентификаторую юзера, чей счет в данный момент редактируется и является единственным и 
      уникальным
